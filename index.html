<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Realtime Chat & Checkbox</title>
  <style>
    body { font-family: Arial, sans-serif; margin: 0; padding: 0; }
    .tabs { display: flex; background: #333; }
    .tab { flex: 1; padding: 1rem; text-align: center; color: #fff; cursor: pointer; }
    .tab.active { background: #555; }
    .panel { display: none; padding: 1rem; }
    .panel.active { display: block; }
    #messages { height: 300px; overflow-y: auto; border: 1px solid #ccc; padding: 0.5rem; }
    #messages .message { margin-bottom: 0.5rem; }
    footer { position: fixed; bottom: 0; width: 100%; background: #f1f1f1; text-align: center; padding: 0.5rem; }
  </style>
  <!-- Firebase SDKs -->
  <script src="https://www.gstatic.com/firebasejs/9.22.2/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.22.2/firebase-database-compat.js"></script>
</head>
<body>
  <div class="tabs">
    <div class="tab active" data-target="chat">Messaging</div>
    <div class="tab" data-target="clicking">Clicking</div>
  </div>
  <div id="chat" class="panel active">
    <div id="messages"></div>
    <input type="text" id="msgInput" placeholder="Type a message..." style="width:80%;" />
    <button id="sendBtn">Send</button>
  </div>
  <div id="clicking" class="panel">
    <div id="checkboxes"></div>
  </div>
  <footer>Your key: <span id="userKey"></span></footer>

  <script>
  // ==== CONFIG ====
  // TODO: Replace with your Firebase project config
  const firebaseConfig = {
    apiKey: "YOUR_API_KEY",
    authDomain: "YOUR_PROJECT_ID.firebaseapp.com",
    databaseURL: "https://YOUR_PROJECT_ID.firebaseio.com",
    projectId: "YOUR_PROJECT_ID",
    storageBucket: "YOUR_PROJECT_ID.appspot.com",
    messagingSenderId: "YOUR_SENDER_ID",
    appId: "YOUR_APP_ID"
  };
  firebase.initializeApp(firebaseConfig);
  const db = firebase.database();

  // ==== UTILITIES ====
  function genKey(len = 16) {
    const chars = 'ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789_';
    let k = '';
    for (let i = 0; i < len; i++) k += chars.charAt(Math.floor(Math.random() * chars.length));
    return k;
  }
  function setCookie(name, value, days = 365) {
    const d = new Date(); d.setTime(d.getTime() + days*24*60*60*1000);
    document.cookie = name + '=' + value + ';expires=' + d.toUTCString() + ';path=/';
  }
  function getCookie(name) {
    const v = document.cookie.match('(^|;) ?' + name + '=([^;]*)(;|$)');
    return v ? v[2] : null;
  }
  // Profanity filter
  const bannedWords = ['badword1','badword2','badword3']; // extend
  function filterProfanity(text) {
    const pattern = new RegExp(bannedWords.join('|'), 'gi');
    return text.replace(pattern, match => '*'.repeat(match.length));
  }

  // ==== USER IDENTIFICATION ====
  let userKey = getCookie('userKey');
  if (!userKey) {
    userKey = genKey(12);
    setCookie('userKey', userKey);
  }
  const username = 'user-' + userKey;
  document.getElementById('userKey').textContent = userKey;

  // ==== TAB LOGIC ====
  document.querySelectorAll('.tab').forEach(tab => {
    tab.addEventListener('click', () => {
      document.querySelectorAll('.tab').forEach(t => t.classList.remove('active'));
      document.querySelectorAll('.panel').forEach(p => p.classList.remove('active'));
      tab.classList.add('active');
      document.getElementById(tab.dataset.target).classList.add('active');
    });
  });

  // ==== MESSAGING ====
  const messagesRef = db.ref('messages');
  document.getElementById('sendBtn').onclick = () => {
    let text = document.getElementById('msgInput').value.trim();
    if (!text) return;
    text = filterProfanity(text);
    messagesRef.push({ username, text, ts: Date.now() });
    document.getElementById('msgInput').value = '';
  };
  messagesRef.limitToLast(100).on('child_added', snap => {
    const msg = snap.val();
    const div = document.createElement('div');
    div.classList.add('message');
    const time = new Date(msg.ts).toLocaleTimeString();
    div.textContent = `[${time}] ${msg.username}: ${msg.text}`;
    document.getElementById('messages').appendChild(div);
    document.getElementById('messages').scrollTop = document.getElementById('messages').scrollHeight;
  });

  // ==== CLICKING (CHECKBOXES) ====
  const tasks = ['Option A','Option B','Option C','Option D'];
  const cbRef = db.ref('checkboxes');
  const container = document.getElementById('checkboxes');

  // create checkboxes in DOM
  tasks.forEach((task, i) => {
    const id = 'task-' + i;
    const wrapper = document.createElement('div');
    const input = document.createElement('input');
    input.type = 'checkbox';
    input.id = id;
    const label = document.createElement('label');
    label.htmlFor = id;
    label.textContent = task;
    wrapper.append(input, label);
    container.appendChild(wrapper);
    input.addEventListener('change', () => {
      cbRef.child(id).set({
        checked: input.checked,
        user: username,
        ts: Date.now()
      });
    });
  });

  // listen for changes
  cbRef.on('value', snap => {
    const data = snap.val() || {};
    tasks.forEach((_, i) => {
      const id = 'task-' + i;
      const state = data[id];
      const el = document.getElementById(id);
      el.checked = state ? state.checked : false;
    });
  });
  </script>
</body>
</html>
